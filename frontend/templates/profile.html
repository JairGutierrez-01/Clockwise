<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Profile - ClockWise</title>

    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='navbar.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='profile.css') }}"
    />

    <style>
      .form-columns {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        width: 100%;
      }

      .form-column {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        width: 100%;
      }

      .profile-upload {
        margin-top: 1.5rem;
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        width: 100%;
      }

      .profile-edit-form label {
        font-weight: bold;
      }

      .profile-edit-form input {
        padding: 0.5rem;
        border-radius: 6px;
        border: none;
      }
    </style>
  </head>

  <body class="dark-mode">
    {% include 'navbar.html' %}

    <div class="profile-container">
      <div class="profile-card">
        <img
          src="{{ url_for('static', filename=user.profile_picture or 'images/default_avatar.png') }}"
          class="profile-picture"
        />

        <h2>{{ user.first_name }} {{ user.last_name }}</h2>
        <p>@{{ user.username }}</p>
        <p>Joined: {{ user.created_at.strftime('%Y-%m-%d') }}</p>
        <p>Last Active: {{ user.last_active.strftime('%Y-%m-%d %H:%M') }}</p>

        <h3 class="section-heading">Edit Profile</h3>
        <form
          class="profile-edit-form"
          method="POST"
          action="{{ url_for('auth.edit_profile', user_id=current_user.user_id) }}"
          enctype="multipart/form-data"
        >
          {% if csrf_token %}{{ csrf_token() }}{% endif %}

          <div class="form-columns">
            <div class="form-column">
              <label for="first_name">First Name</label>
              <input
                type="text"
                id="first_name"
                name="first_name"
                value="{{ user.first_name }}"
                required
              />

              <label for="last_name">Last Name</label>
              <input
                type="text"
                id="last_name"
                name="last_name"
                value="{{ user.last_name }}"
                required
              />

              <label for="username">Username</label>
              <input
                type="text"
                id="username"
                name="username"
                value="{{ user.username }}"
                required
              />

              <label for="email">Email</label>
              <input
                type="email"
                id="email"
                name="email"
                value="{{ user.email }}"
                required
              />

              <label for="password">New Password (optional)</label>
              <input
                type="password"
                id="password"
                name="password"
                placeholder="Leave blank to keep current password"
              />

              <label for="confirm_password">Confirm Password</label>
              <input
                type="password"
                id="confirm_password"
                name="confirm_password"
                placeholder="Only required if changing password"
              />
            </div>
          </div>

          <div class="profile-upload">
            <label for="profile_picture">Change Profile Picture </label>
            <input
              type="file"
              name="profile_picture"
              id="profile_picture"
              accept="image/*"
            />
          </div>
          <div class="button-wrapper">
            <button class="btn-primary">Save Changes</button>
          </div>
        </form>

        <div class="teams">
          <h3>Teams</h3>
          <ul>
            {% for ut in user.teams %}
            <li>{{ ut.team.name }} ({{ ut.role }})</li>
            {% else %}
            <li>No team memberships</li>
            {% endfor %}
          </ul>
        </div>

        <div class="projects">
          <h3>My Projects</h3>
          <div class="project-list">
            {% for project in user.project %}
            <div
              class="project-card"
              onclick="window.location.href='{{ url_for('projects') }}?project_id={{ project.project_id }}'"
            >
              <h2 class="project-card__name">{{ project.name }}</h2>
              <div class="project-card__meta">
                <p>Type: {{ project.type.value }}</p>
                <p>Limit: {{ project.time_limit_hours }} h</p>
                <p>Spent: {{ project.current_hours or 0 }} h</p>
              </div>
            </div>
            {% else %}
            <p>No projects found</p>
            {% endfor %}
          </div>
        </div>

        <form
          class="delete-profile-form"
          method="POST"
          action="{{ url_for('auth.user_delete', user_id=current_user.user_id) }}"
          onsubmit="return confirm('Are you sure you want to permanently delete your account? This action cannot be undone.');"
        >
          {% if csrf_token %}{{ csrf_token() }}{% endif %}
          <div class="button-wrapper">
            <button class="btn-primary">Permanently Delete Account</button>
          </div>
        </form>
      </div>
    </div>

    <script src="{{ url_for('static', filename='js/theme.js') }}"></script>
    {% if user_logged_in %}
    <script src="{{ url_for('static', filename='js/base.js') }}"></script>
    {% endif %}
  </body>
</html>
