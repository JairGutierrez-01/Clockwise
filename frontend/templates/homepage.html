<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ClockWise</title>

    <!-- Stylesheets -->
    <link rel="stylesheet" href="{{ url_for('static', filename='homepage.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='navbar.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='themes.css') }}">
  </head>

  <body class="dark-mode">
    <!-- NAVBAR -->
    <nav class="navbar">
      <div class="logo">ClockWise</div>

      <div class="nav-items">
        {% if user_logged_in %}
        <div class="notification-icon">
          <a href="{{ url_for('notifications') }}">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              fill="none"
              stroke="currentColor"
              stroke-width="1.5"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="feather feather-bell"
            >
              <path d="M18 8a6 6 0 00-12 0c0 7-3 9-3 9h18s-3-2-3-9"></path>
              <path d="M13.73 21a2 2 0 01-3.46 0"></path>
            </svg>
            {% if has_notifications %}
            <span class="notification-dot"></span>
            {% endif %}
          </a>
        </div>
        {% endif %}
        <a href="#track">Track</a>
        <a href="#analyze">Analyze</a>
        <a href="#plan">Plan</a>
        <!-- Dashboard (conditional) -->
        <a
          href="{{ url_for('dashboard') if user_logged_in else url_for('auth.login') }}"
          >Dashboard</a
        >

        <!-- Theme Toggle -->
        {% include 'theme.html' %}

        <!-- Login-/Logout-Button wechsel -->
        {% if user_logged_in %}
        <a href="{{ url_for('logout') }}" class="login-btn">Log Out</a>
        {% else %}
        <a href="{{ url_for('auth.login') }}" class="login-btn">Log In</a>
        {% endif %}
      </div>
    </nav>

    <!-- HERO -->
    <header class="hero">
      <div class="hero-content">
        <h1>Track your time efficiently</h1>
        <p>Track and analyze your project-related activities</p>
        <a href="{{ url_for('auth.login') }}" class="cta-btn">Get Started</a>
      </div>
    </header>

    <!-- MAIN SECTIONS -->
    <div class="main-wrapper">
      <!-- TRACK -->
      <section id="track" class="section">
        <div class="split-container">
          <div class="text-block">
            <h2>Track</h2>
            <p>Track the time you work on your projects in real time.</p>
          </div>

          <div class="timer-reflection-wrapper" style="position: relative">
            <div class="timer-box original-box">
              <div class="clock-icon">
                <svg
                  id="clock"
                  xmlns="http://www.w3.org/2000/svg"
                  width="120"
                  height="120"
                  viewBox="0 0 100 100"
                >
                  <circle
                    cx="50"
                    cy="50"
                    r="48"
                    stroke="#7AB8F5"
                    stroke-width="4"
                    fill="none"
                  ></circle>
                  <line
                    id="minuteHand"
                    x1="50"
                    y1="50"
                    x2="50"
                    y2="25"
                    stroke="#7AB8F5"
                    stroke-width="3"
                    stroke-linecap="round"
                  ></line>
                  <line
                    id="secondHand"
                    x1="50"
                    y1="50"
                    x2="50"
                    y2="20"
                    stroke="#7AB8F5"
                    stroke-width="2"
                    stroke-linecap="round"
                  ></line>
                </svg>
              </div>
              <div class="time-display" id="time">00:00:00</div>
              <div class="button-row">
                <button onclick="startTimer()">Start</button>
                <button onclick="pauseTimer()">Pause</button>
                <button onclick="stopTimer()">Stop</button>
              </div>
            </div>
            <div class="reflection-layer"></div>
          </div>
        </div>
      </section>

      <!-- ANALYZE -->
      <section id="analyze" class="section">
        <div class="split-container">
          <!-- Picture left -->
          <div
            class="diagram-box"
            style="display: flex; justify-content: center; align-items: center"
          >
            <img
              id="analyze-img"
              src="{{ url_for('static', filename='images/AnalyzeDiagram.png') }}"
              alt="Analyze Diagram"
              style="
                width: 97%;
                height: auto;
                object-fit: contain;
                border-radius: 12px;
              "
            />
            <div class="reflection-layer reflection-analyze"></div>
          </div>

          <!-- Text right -->
          <div class="text-block">
            <h2>Analyze</h2>
            <p>
              Visualize your time distribution – with interactive diagrams for
              optimal insight.
            </p>
          </div>
        </div>
      </section>

      <!-- PLAN -->
      <section id="plan" class="section">
        <div class="split-container">
          <!-- Text left -->
          <div class="text-block">
            <h2>Plan</h2>
            <p>
              Plan and structure your tasks effectively to reach your goals.
            </p>
          </div>

          <!-- Picture right -->
          <div
            class="diagram-box"
            style="display: flex; justify-content: center; align-items: center"
          >
            <img
              id="plan-img"
              src="{{ url_for('static', filename='images/PlanDiagram.png') }}"
              alt="Analyze Diagram"
              style="
                width: 97%;
                height: auto;
                object-fit: contain;
                border-radius: 12px;
              "
            />
            <div class="reflection-layer reflection-analyze"></div>
          </div>
        </div>
      </section>
    </div>

    <!-- SCRIPT -->
    <script>
        // ============================
        //       Timer-Funktionalität
        // ============================

        let timerInterval;
        let seconds = 0;
        let running = false;
        let paused = false;

        const timeDisplay = document.getElementById("time");
        const secondHand = document.getElementById("secondHand");
        const minuteHand = document.getElementById("minuteHand");
        const pauseButton = document.querySelector(".button-row").children[1];

        /**
         * Aktualisiert die numerische Anzeige der gestoppten Zeit im Format HH:MM:SS.
         */
        function updateDisplay() {
          const hrs = String(Math.floor(seconds / 3600)).padStart(2, "0");
          const mins = String(Math.floor((seconds % 3600) / 60)).padStart(2, "0");
          const secs = String(seconds % 60).padStart(2, "0");
          timeDisplay.textContent = `${hrs}:${mins}:${secs}`;
        }

        /**
         * Aktualisiert die Positionen der Sekunden- und Minutenzeiger im UI.
         */
        function updateClock() {
          const secDeg = (seconds % 60) * 6;
          const minDeg = (seconds / 60) * 6;
          secondHand.style.transform = `rotate(${secDeg}deg)`;
          minuteHand.style.transform = `rotate(${minDeg}deg)`;
        }

        /**
         * Startet den Timer oder setzt ihn fort, wenn er pausiert war.
         */
        function startTimer() {
          if (running && paused) {
            paused = false;
            pauseButton.textContent = "Pause";
            timeDisplay.classList.remove("blink");
            return;
          }

          if (running) return;
          running = true;
          paused = false;

          timerInterval = setInterval(() => {
            if (!paused) {
              seconds++;
              updateDisplay();
              updateClock();
            }
          }, 1000);
        }

        /**
         * Pausiert oder setzt den Timer fort. Ändert den Button-Text und visuelles Feedback.
         */
        function pauseTimer() {
          if (!running) return;
          paused = !paused;
          pauseButton.textContent = paused ? "Resume" : "Pause";
          timeDisplay.classList.toggle("blink", paused);
        }

        /**
         * Stoppt und setzt den Timer vollständig zurück. Entfernt alle visuelle Markierungen.
         */
        function stopTimer() {
          clearInterval(timerInterval);
          timerInterval = null;
          seconds = 0;
          running = false;
          paused = false;
          updateDisplay();
          updateClock();
          pauseButton.textContent = "Pause";
          timeDisplay.classList.remove("blink");
        }

        // Initialer Anzeigeaufbau beim Laden
        updateDisplay();
        updateClock();

        // ============================
        //       Scrollanimation
        // ============================

        const sections = document.querySelectorAll(".section");
        let lastScrollY = window.scrollY;
        let scrollDirection = "down";

        // Bestimmt die Scrollrichtung
        window.addEventListener("scroll", () => {
          const currentScrollY = window.scrollY;
          scrollDirection = currentScrollY > lastScrollY ? "down" : "up";
          lastScrollY = currentScrollY;
        });

        /**
         * IntersectionObserver, um Scrollanimationen auszulösen,
         * abhängig davon, ob ein Element im Viewport ist.
         */
        const fadeObserver = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              const section = entry.target;

              if (entry.isIntersecting) {
                section.classList.add("animate-in");
                section.classList.remove("animate-out-up", "animate-out-down");
              } else {
                section.classList.remove("animate-in");
                section.classList.add(
                  scrollDirection === "down"
                    ? "animate-out-up"
                    : "animate-out-down"
                );
              }
            });
          },
          { threshold: 0.4 }
        );

        sections.forEach((section) => fadeObserver.observe(section));

        // ============================
        //       Bildwechsel bei Modus
        // ============================

        /**
         * Wechselt das Bild basierend auf dem aktiven Farbschema (Light/Dark Mode).
         */
        function updateAnalyzeImage() {
          const img = document.getElementById("analyze-img");
          if (document.body.classList.contains("light-mode")) {
            img.src = "{{ url_for('static', filename='images/AnalyzeDiagramLightMode.png') }}";
          } else {
            img.src = "{{ url_for('static', filename='images/AnalyzeDiagram.png') }}";
          }
        }

        // Beim Seitenstart prüfen und Bild anpassen
        updateAnalyzeImage();
    </script>
    <script src="{{ url_for('static', filename='js/theme.js') }}"></script>
    {% if user_logged_in %}
    <script src="{{ url_for('static', filename='js/base.js') }}"></script>
    {% endif %}
  </body>
</html>
